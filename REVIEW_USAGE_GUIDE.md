# 教师批改报告功能使用说明

## 📌 功能概述

系统现在包含两个独立的菜单：
1. **实验任务管理** - 教师发布和管理实验任务，学生在线完成任务
2. **报告批改** - 教师批改学生提交的实验报告（新增菜单）

## 🎯 菜单结构

### 1. 实验任务管理（原有菜单）

**路径**：`/task`
**权限**：`task:task:list`

**功能**：
- ✅ 教师：发布任务、编辑任务、删除任务、查看详情
- ✅ 学生：查看任务、在线完成任务（进行中的任务）

**教师端操作**：
```
[查看详情] [编辑] [删除] [成绩统计(已结束)]
```

**学生端操作**：
```
[查看详情] [在线完成(进行中)] [成绩统计(已结束)]
```

### 2. 报告批改（新增菜单）⭐

**路径**：`/review`
**权限**：`task:task:add` （教师权限）

**功能**：
- ✅ 显示所有需要批改的任务列表
- ✅ 显示提交情况和批改进度
- ✅ 点击任务进入批改流程

**页面层级**：
```
报告批改（入口页）
    ↓ 点击"批改报告"
批改列表页（某任务的所有学生提交）
    ↓ 点击"开始批改"
批改详情页（OnlyOffice + 批改表单）
```

## 📁 文件结构

### 前端文件

```
ruoyi-ui/src/
├── api/task/
│   └── review.js                 # 批改相关API接口
├── views/
│   ├── task/
│   │   ├── index.vue            # 实验任务管理（已修复）
│   │   ├── edit.vue             # 学生在线完成
│   │   ├── review-list.vue      # 批改列表页
│   │   └── review-detail.vue    # 批改详情页
│   └── review/
│       └── index.vue            # 报告批改入口页（新增）⭐
```

### 后端接口

**ExpTaskController.java** 新增接口：
- `GET /Task/submit/list/{taskId}` - 获取提交列表
- `GET /Task/submit/{submitId}` - 获取批改详情
- `POST /Task/submit/review` - 保存批改结果
- `GET /Task/submit/export/{taskId}` - 批量导出成绩
- `GET /Task/submit/idList/{taskId}` - 获取提交ID列表

## 🚀 配置步骤

### 1. 后端配置（已完成）

后端接口已经开发完成，无需额外配置。

### 2. 前端路由配置

需要在前端路由中添加以下路由（如果使用动态路由则无需手动配置）：

**手动配置方式**（如果需要）：

编辑 `ruoyi-ui/src/router/index.js`，添加：

```javascript
{
  path: '/review',
  component: Layout,
  hidden: false,
  meta: { title: '报告批改', icon: 'edit' },
  children: [
    {
      path: '',
      component: () => import('@/views/review/index'),
      name: 'ReviewIndex',
      meta: { title: '报告批改', icon: 'edit' }
    }
  ]
},
{
  path: '/task',
  component: Layout,
  children: [
    // ... 其他任务路由
    {
      path: 'review/:taskId',
      component: () => import('@/views/task/review-list'),
      name: 'ReviewList',
      meta: { title: '批改列表', activeMenu: '/review' },
      hidden: true
    },
    {
      path: 'review/:taskId/:submitId',
      component: () => import('@/views/task/review-detail'),
      name: 'ReviewDetail',
      meta: { title: '批改详情', activeMenu: '/review' },
      hidden: true
    }
  ]
}
```

### 3. 菜单配置（推荐使用后台配置）

在系统管理 > 菜单管理中添加：

**一级菜单：报告批改**
```
菜单名称：报告批改
路由地址：/review
组件路径：review/index
菜单图标：edit
权限标识：task:task:add
```

## 💡 使用流程

### 教师批改流程

#### 方式一：从"报告批改"菜单进入（推荐）⭐

```
1. 点击左侧菜单"报告批改"
   ↓
2. 看到所有任务列表（显示提交情况和批改进度）
   任务列表显示：
   - 任务名称、课程名称
   - 提交情况：25/30 (83%)
   - 批改进度：已批 10/25
   - 状态标签
   ↓
3. 点击某个任务的"批改报告"按钮
   ↓
4. 进入批改列表页（显示该任务所有学生提交）
   可以筛选：全部/待批改/已批改/未提交
   可以搜索：按学号或姓名
   ↓
5. 点击"开始批改"
   ↓
6. 进入批改详情页
   - 左侧：OnlyOffice文档预览（可添加批注）
   - 右侧：批改表单（分数、评语）
   ↓
7. 进行批改
   - 在文档中添加批注（红色标记）
   - 输入分数（0-100）
   - 输入教师评语
   ↓
8. 保存批改
   - 点击"保存"：保存当前批改
   - 点击"保存并下一个"：保存并跳转到下一个待批改学生
   - 使用快捷键 Ctrl+S：快速保存
   - 使用快捷键 Ctrl+→：下一个学生
```

#### 方式二：从"实验任务管理"查看（仅供参考）

在实验任务管理中，教师不再看到"批改报告"按钮。所有批改操作都从"报告批改"菜单进入。

### 学生提交流程（不变）

```
1. 进入"实验任务管理"
   ↓
2. 找到进行中的任务，点击"在线完成"
   ↓
3. 在OnlyOffice中编辑实验报告
   ↓
4. 点击"提交任务"
   ↓
5. 等待教师批改
   ↓
6. 批改完成后查看分数和评语
```

## 🎨 界面预览

### 报告批改入口页

```
┌─────────────────────────────────────────────────────────────┐
│ 报告批改                                                     │
│ ℹ️ 这里显示所有需要批改的实验任务...                        │
├─────────────────────────────────────────────────────────────┤
│ 搜索：[任务名称] [课程名称] [搜索] [重置]                   │
├─────────────────────────────────────────────────────────────┤
│ 任务名称        提交情况    批改进度        操作            │
│ Python基础实验  25/30 83%  ████████░░ 40%  [批改报告]      │
│ 数据结构实验    18/30 60%  ████░░░░░░ 20%  [批改报告]      │
│ Web开发实验     22/28 79%  ██████████ 100% [批改报告]      │
└─────────────────────────────────────────────────────────────┘
```

### 批改列表页

```
┌─────────────────────────────────────────────────────────────┐
│ 任务列表 > Python基础实验 - 批改列表                        │
├─────────────────────────────────────────────────────────────┤
│ 📋 任务信息                                                  │
│ 提交情况：25/30  批改进度：10/25  平均分：82.5             │
├─────────────────────────────────────────────────────────────┤
│ 筛选：[全部(30)] [待批改(15)] [已批改(10)] [未提交(5)]     │
├─────────────────────────────────────────────────────────────┤
│ 学号     姓名    提交时间         状态      分数   操作      │
│ 202101   张三   2025-01-10 10:00  ✅已批改  85    [查看]    │
│ 202102   李四   2025-01-10 11:30  ⏳待批改   -    [批改]    │
├─────────────────────────────────────────────────────────────┤
│ [批量导出成绩]                                  【分页】     │
└─────────────────────────────────────────────────────────────┘
```

### 批改详情页

```
┌────────────────────────────────────────────────────────────┐
│ [← 返回]  张三的报告  已批改 2/25  [上一个] [下一个]        │
├──────────────────────────┬─────────────────────────────────┤
│                          │ 👤 学生信息                      │
│                          │ 姓名：张三  学号：202101         │
│                          ├─────────────────────────────────┤
│   OnlyOffice编辑器        │ 📊 评分                          │
│   （可添加批注）          │ 分数：[  85  ]                   │
│                          │ 💡 优秀(90-100) 良好(80-89)      │
│                          ├─────────────────────────────────┤
│                          │ 📝 教师评语                      │
│                          │ [实验完成质量较好...]            │
│                          │ 常用评语：[优秀][良好][需改进]   │
│                          ├─────────────────────────────────┤
│                          │ [保存] [保存并下一个]            │
│                          │ 💡 Ctrl+S 快速保存               │
└──────────────────────────┴─────────────────────────────────┘
```

## ⚙️ 功能特性

### 批改入口页特性
- ✅ 任务列表概览
- ✅ 提交情况统计（百分比、进度条）
- ✅ 批改进度可视化
- ✅ 任务搜索功能

### 批改列表页特性
- ✅ 任务信息卡片
- ✅ 实时统计（提交、批改、平均分）
- ✅ 多维度筛选（全部/待批改/已批改/未提交）
- ✅ 学号姓名搜索
- ✅ 批量导出成绩（Excel）

### 批改详情页特性
- ✅ OnlyOffice在线批注
- ✅ 评分输入（0-100分）
- ✅ 评语模板快速插入
- ✅ 上一个/下一个快速导航
- ✅ 保存并下一个（连续批改）
- ✅ 快捷键支持（Ctrl+S、Ctrl+→、Ctrl+←）
- ✅ 批改进度实时显示

## 🔧 常见问题

### Q1: 看不到"报告批改"菜单？
**A**: 检查权限配置，确保教师角色有 `task:task:add` 权限。

### Q2: 实验任务管理数据加载不出来？
**A**: 已修复，确保前端代码已更新。

### Q3: OnlyOffice文档加载失败？
**A**: 检查：
1. OnlyOffice Document Server是否正常运行
2. 文档服务器地址配置是否正确
3. MinIO服务是否正常运行

### Q4: 批改进度不更新？
**A**: 批改进度需要后端返回 `reviewedCount` 字段，如果没有显示，需要在后端补充该字段的查询逻辑。

### Q5: 快捷键不生效？
**A**: 确保焦点在批改详情页面，不要在输入框中。

## 📊 数据库说明

使用现有的 `exp_task_submit` 表，字段包括：
- `submit_id` - 提交记录ID
- `task_id` - 任务ID
- `user_id` - 学生ID
- `user_name` - 学生姓名
- `file_url` - 提交文件URL
- `document_key` - OnlyOffice文档key
- `submit_time` - 提交时间
- `status` - 状态（0待批阅 1已批阅）
- `score` - 分数
- `teacher_remark` - 教师评语
- `update_by` - 批改教师
- `update_time` - 批改时间

## 🎯 下一步优化建议

1. **后端优化**：在任务列表接口中返回 `reviewedCount` 字段
2. **批改统计**：添加成绩分布图表
3. **消息通知**：批改完成后通知学生
4. **评语模板**：支持教师自定义评语模板
5. **批量操作**：支持批量给分

---

**版本**：v1.0
**更新日期**：2025-12-30
**作者**：Claude Code
